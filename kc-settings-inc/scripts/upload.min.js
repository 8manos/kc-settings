var win=window.dialogArguments||opener||parent||top;(function(d){var c=win.kcSettings.upload.text,e=win.kcSettings.upload.target.data("currentFiles"),b=d(),a=d('<div class="kcs-wrap"><h4>'+c.head+'</h4> <a class="button check-all">'+c.checkAll+'</a> <a class="button check-invert">'+c.invert+'</a> <a class="button check-clear">'+c.clear+'</a> <a class="button add-checked">'+c.addFiles+"</a></div>").on("click","a",function(i){i.preventDefault();var f=d(this);if(f.is(".check-all")){b.prop("checked",true).trigger("change")}else{if(f.is(".check-clear")){b.prop("checked",false).trigger("change")}else{if(f.is(".check-invert")){b.each(function(){d(this).prop("checked",!this.checked).trigger("change")})}else{if(f.is(".add-checked")){var j=b.filter(":checked"),h=j.length;if(!h){return}var g={};j.each(function(){var k=this.value,m="file_"+k,l=d(this);g["file_"+k]={id:k,title:l.siblings(".title").text(),img:l.closest(".media-item").find(".pinkynail").attr("src")}});win.kcFileMultiple(g);win.tb_remove()}}}}});d.fn.kcsfPrepare=function(g,f){return this.each(function(){var h=d(this),i=h.children();if(!i.length){return}if(!h.siblings("div.kcs-wrap").length){h.parent().append(a)}i.each(function(m){var k=d(this);if(k.find("input.kcs-files").length){return}var j=g?f:k.attr("id").split("-")[2],l=(d.inArray(j,e)>-1)?' checked="checked"':"",n=d('<input type="checkbox" value="'+j+'" '+l+'class="kcs-files" />');b=b.add(n);k.children(".new").prepend(n).wrapInner("<label />")});b.trigger("change")})};d(document).ready(function(f){f("body").on("change","input.kcs-files",function(){var g=b.filter(function(h){return f(this).prop("checked")});if(g.length){f("a.add-checked, a.check-clear",a).show()}else{f("a.add-checked, a.check-clear",a).hide()}});f("#library-form, #gallery-form").find("#media-items").kcsfPrepare(false);f("#media-upload").ajaxComplete(function(h,i,g){if(i.status!==200||g.url!=="async-upload.php"){return}f("#media-items",this).kcsfPrepare(true,i.responseText.match(/type-of-(\d+)/)[1])})})})(jQuery);