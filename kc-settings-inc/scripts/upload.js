var win=window.dialogArguments||opener||parent||top;jQuery(document).ready(function(e){var i=e("#library-form, #gallery-form"),h=e("#file-form");$mItems=e("#media-items");if(i.length){var d=win.kcSettings.upload.text,g=win.kcSettings.upload.target.data("currentFiles"),a=e('<div class="kcs-wrap"><h4>'+d.head+"</h4></div>"),j=e();if(!$mItems.children().length){a.append("<p>"+d.empty+"</p>")}else{var k=e('<a class="button">'+d.checkAll+"</a>"),f=e('<a class="button">'+d.clear+"</a>"),c=e('<a class="button">'+d.invert+"</a>"),b=e('<a class="button">'+d.addFiles+"</a>");e(".new",$mItems).each(function(o){var m=e(this).parent(),l=m.attr("id").split("-")[2],n=(e.inArray(l,g)>-1)?' checked="checked"':"",p=e('<input type="checkbox" value="'+l+'" '+n+'class="kcs-files" style="margin-right:.5em"/>');j=j.add(p);m.children(".new").prepend(p).wrapInner("<label />")});k.click(function(l){l.preventDefault();j.prop("checked",true)});f.click(function(l){l.preventDefault();j.prop("checked",false)});c.click(function(l){l.preventDefault();j.each(function(){e(this).prop("checked",!this.checked)})});b.click(function(n){n.preventDefault();var o=j.filter(":checked"),m=o.length;if(!m){return false}var l={};o.each(function(){var p=this.value,r=r="file_"+p,q=e(this);l["file_"+p]={id:p,title:q.siblings(".title").text(),img:q.closest(".media-item").find(".pinkynail").attr("src")}});win.kcFileMultiple(l);win.tb_remove()});a.append(k,f,c,b)}i.append(a)}else{if(h.length){h.after('<div class="kcs-file-info"><h3>'+win.kcSettings.upload.text.head+"</h3><p>"+win.kcSettings.upload.text.info+"</p><div>")}}});