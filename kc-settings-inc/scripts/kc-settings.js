var win=window.dialogArguments||opener||parent||top;(function(a){win.kcFileMultiple=function(f){var b=win.kcSettings.upload.target,g=b.data("currentFiles"),d=b.children().last(),h=a(),c=null;for(var e in f){if(!f.hasOwnProperty(e)||a.inArray(f[e].id,g)>-1){continue}c=d.clone().removeClass("hidden");c.find("img").attr("src",f[e].img);c.find("input").val(f[e].id).prop("checked",false);c.find(".title").text(f[e].title);h=h.add(c)}b.append(h);if(d.is(".hidden")){h.show();d.remove()}b.show().prev(".info").show()};win.kcFileSingle=function(f){var b=win.kcSettings.upload.target,e=b.find("span").text(f.title),d=b.find("img").attr("src",f.img);b.removeAttr("data-type");b.find("input").val(f.id);b.children("a.up").hide();b.find("p").fadeIn().children("a.up").show().siblings("a.rm").show();if(f.type=="image"){b.attr("data-type",f.type);e.hide();var c=b.data("size");if(c!=="thumbnail"){a.ajax({type:"POST",url:ajaxurl,data:{action:"kc_get_image_url",id:f.id,size:c},success:function(g){if(g){d.attr("src",g)}}})}}else{e.show()}}})(jQuery);jQuery(document).ready(function(f){var e=f(this),d=f("body"),l=f("#kcsb"),g=f("form.kcsb"),b=f("#kc-settings-form");var i={sortable:{axis:"y",start:function(m,n){n.placeholder.height(n.item.outerHeight())},stop:function(m,n){n.item.parent().kcReorder(n.item.data("mode"),true).children().each(function(){f("> details > summary > .actions .count",this).text(f(this).index()+1)})}},colorpicker:{onBeforeShow:function(){f(this).ColorPickerSetColor(this.value)},onSubmit:function(m,q,o,p){var n="#"+q;f(p).css({backgroundColor:n,color:invertColor(n)}).val(n).ColorPickerHide()}},datepicker:{date:{dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,showButtonPanel:true},month:{changeMonth:true,changeYear:true,showButtonPanel:true,dateFormat:"yy-mm",onClose:function(q,o){var m=f(o.dpDiv),p=m.find(".ui-datepicker-month :selected").val(),n=m.find(".ui-datepicker-year :selected").val();f(this).datepicker("setDate",new Date(n,p,1))}}}};b.kcMetaboxDeps();f("ul.kc-rows").sortable(i.sortable);d.on("click",".row a.del",function(q){q.preventDefault();var n=f(this),m=n.closest(".row");if(!m.siblings(".row").length){n.siblings("a.clear").click();return}var o=m.parent(),r=m.data("mode"),p=m.is(":last-child");m.addClass("removing").fadeOut("slow",function(){m.remove();if(!p){o.kcReorder(r,true);if(g.length){o.children().each(function(){f("> details > summary > .actions .count",this).text(f(this).index()+1)})}}})});d.on("click",".row a.add",function(r){r.preventDefault();var u=f(this),t=u.closest(".row"),n=t.parent(),q=t.data("mode"),o=t.is(":last-child"),p=t.clone(false).addClass("adding"),s=false,m=400;if(q=="sections"){s=true;m=1200}else{if(q=="fields"){s=true;m=800}}if(g.length){p.find(".kc-rows").each(function(){f(this).children(".row").not(":first").remove()});p.find(":input").each(function(){var v=f(this);if(this.type=="text"||this.type=="textarea"){v.removeAttr("style").val("")}else{if(this.type=="checkbox"||this.type=="radio"){v.prop("checked",this.checked)}}if(v.is(".kcsb-ids")){v.kcsbUnique()}})}else{p.find(":input").each(function(){var v=f(this);if(v.data("nocleanup")!==true){v.val("")}})}f("ul.kc-rows").sortable(i.sortable);f(".hasdep",p).kcFormDep();f(".hasDatepicker",p).each(function(){f(this).removeClass("hasDatepicker").removeAttr("id").datepicker(i.datepicker[f(this).attr("type")])});f(".hasColorpicker",p).each(function(){f(this).removeAttr("style").ColorPicker(i.colorpicker)});t.after(p);if(s){p.kcGoto({offset:-100,speed:m})}setTimeout(function(){p.removeClass("adding")},m);n.kcReorder(q,true);if(g.length){if(o){f("> details > summary > .actions .count",p).text(p.index()+1)}else{n.children().each(function(){f("> details > summary > .actions .count",this).text(f(this).index()+1)})}}});d.on("click",".row a.clear",function(m){m.preventDefault();f(this).closest(".row").find(":input").val("")});var a=f("input[type=date], input[type=month]");if(a.length&&Modernizr.inputtypes.date===false){var h=f("body").is(".admin-color-classic")?"cupertino":"flick";Modernizr.load([{load:win.kcSettings.paths.styles+"/jquery-ui/"+h+"/style.css",complete:function(){a.each(function(){f(this).datepicker(i.datepicker[f(this).attr("type")])})}}])}var k=f("input[type=color]");if(k.length&&Modernizr.inputtypes.color===false){Modernizr.load([{load:[win.kcSettings.paths.scripts+"/colorpicker/js/colorpicker.js",win.kcSettings.paths.scripts+"/colorpicker/css/colorpicker.css",win.kcSettings.paths.scripts+"/rgbcolor.js"],complete:function(){k.ColorPicker(i.colorpicker).each(function(){var m=f(this).addClass("hasColorpicker");if(m.val()!==""){m.css({backgroundColor:this.value,color:invertColor(this.value)})}})}}])}d.on("click",".kcs-file a.rm",function(n){n.preventDefault();var m=f(this).closest(".row");m.addClass("removing").fadeOut("slow",function(){if(m.siblings().length){m.remove()}else{m.removeClass("removing").addClass("hidden").find(":input").val("").prop("checked",false);f("input.fileID",m).prop("disabled",true);m.parent().hide().prev(".info").hide()}})});d.on("click","a.kcsf-upload",function(q){q.preventDefault();var o=f(this),m=o.siblings(".kc-rows"),n=m.find(".row.hidden"),p=[];if(n.length){f("input.fileID",n).prop("disabled",false)}else{f("input.fileID",m).each(function(){p.push(this.value)})}win.kcSettings.upload.target=m.data("currentFiles",p);tb_show("",o.attr("href"))});d.on("click",".kcs-file-single a.rm",function(m){m.preventDefault();f(this).fadeOut().closest("div").find("p.current").fadeOut(function(){f(this).siblings("a.up").show().siblings("input").val("")})});d.on("click",".kcs-file-single a.up",function(n){n.preventDefault();var m=f(this);win.kcSettings.upload.target=m.closest("div");tb_show("",m.attr("href"))});f("a.kc-help-trigger").on("click",function(m){m.preventDefault();f("#contextual-help-link").click();f("#screen-meta").kcGoto()});f(".kcs-tabs").kcTabs();var j=f("#addtag");if(j.length){var c=f();f("div.kcs-field").each(function(){c=c.add(f(this).clone())});if(c.length){j.ajaxComplete(function(n,o,m){if(m.data.indexOf("action=add-tag")<0){return}f("div.kcs-field").each(function(p){f(this).replaceWith(c.eq(p).clone())});f(".kcs-tabs",j).kcTabs();j.trigger("kcsRefreshed")})}}if(l.length){if(!l.is(".hidden")){l.kcGoto()}f(".hasdep",l).kcFormDep();d.on("blur","input.kcsb-slug",function(){var m=f(this);m.val(kcsbSlug(m.val()))});f("input.kcsb-ids").kcsbUnique();d.on("blur","input.required, input.clone-id",function(){f(this).kcsbCheck()});f("#new-kcsb").on("click",function(m){m.preventDefault();l.kcGoto()});f("a.kcsb-cancel").on("click",function(m){m.preventDefault();f("#kcsb").slideUp("slow")});f("a.clone-open").on("click",function(m){m.preventDefault();f(this).parent().children().hide().filter("div.kcsb-clone").fadeIn(function(){f(this).find("input.clone-id").focus()})});f("a.clone-do").on("click",function(n){var m=f(this),o=f(this).siblings("input");if(o.kcsbCheck()===false){return false}m.attr("href",m.attr("href")+"&new="+o.val())});f("input.clone-id").on("keypress",function(n){var m=n.keyCode||n.which;if(m===13){n.preventDefault();f(this).blur().siblings("a.clone-do").click()}});f(".kcsb-tools a.close").on("click",function(n){n.preventDefault();var m=f(this);m.siblings("input").val("");m.parent().fadeOut(function(){f(this).siblings().show()})});g.submit(function(n){var m=true;f(this).find("input.required").not(":disabled").each(function(){if(f(this).kcsbCheck()===false){m=false;return false}});if(!m){return false}})}});