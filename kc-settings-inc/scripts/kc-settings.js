var win=window.dialogArguments||opener||parent||top;win.kcsInsertFiles=function(){var d=win.kcSettings.upload.nu.length;if(d){var a=win.kcSettings.upload.id,b=a.children().last(),e=jQuery();while(d){d--;var c=b.clone();jQuery("input",c).each(function(){this.value=win.kcSettings.upload.nu[d][0]});jQuery(".title",c).text(win.kcSettings.upload.nu[d][1]);c.find("img").attr("src",win.kcSettings.upload.nu[d][2]);e=e.add(c)}a.append(e);if(b.is(".hidden")){e.show();b.remove()}}};function inArray(d,c){var b=c.length;for(var a=0;a<b;a++){if(c[a]==d){return true}}return false}function kcsbSlug(a){strNu=a.replace(/^\-+/,"");strNu=strNu.replace(/^_+/,"");strNu=strNu.replace(/[^A-Za-z0-9\-_]/g,"");if(strNu.match(/^\-+/)||strNu.match(/^_+/)){strNu=kcsbSlug(strNu)}return strNu}(function(a){a.fn.kcsbShowDeps=function(b){return this.each(function(){var c=a(this);if(c.is(b)){if(c.is(":hidden")){c.fadeIn().find(":input").each(function(){a(this).removeAttr("disabled")})}}else{c.hide().find(":input").each(function(){a(this).attr("disabled",true)})}})};a.fn.kcsbIDep=function(){return this.each(function(){var d=a(this),f=d.val(),c=d.attr("name").match(/\[(\w+)\]$/)[1],e=d.parent().siblings(".idep_"+c);if(d.is(".global")){var b=a(".global_idep_"+c);e=e.add(b)}if(!e.length){return}d.data("targets",e);e.kcsbShowDeps("."+f);d.change(function(){var g=a(this);g.data("targets").kcsbShowDeps("."+g.val())})})};a.fn.kcsbGoto=function(){return this.each(function(){var b=a(this);b.fadeIn(function(){a("html, body").stop().animate({scrollTop:(b.offset().top-20)},800)})})};a.fn.kcsbUnique=function(){return this.each(function(){var c=a(this),b=c.val();c.data("olVal",b).blur(function(){var f=a(this),e=c.data("olVal"),d=f.val();if(d!=e&&inArray(d,kcSettings._ids[f.data("ids")])){f.val("")}})})};a.fn.kcsbCheck=function(){var b=a(this);if(b.val()==""){b.focus().css("borderColor","#ff0000");return false}else{b.removeAttr("style")}};a.fn.kcsbReorder=function(c){var b=new RegExp(c+"\\]\\[(\\d+)");return this.each(function(){var e=a(this),f=e.children(),d=-1;f.each(function(){a("> .actions .count",this).text(a(this).index()+1);d++;a(this).find(":input").each(function(){this.name=this.name.replace(b,function(h,g){return c+"]["+d})})})})}})(jQuery);jQuery(document).ready(function(d){var i=d("#kcsb"),e=d("form.kcsb"),a=d("#kc-settings-form").find("div.postbox").find("#kcs-components");if(a.length){var c="#"+a.closest("div.metabox-holder").attr("id")+"-",f=a.find(":checkbox"),g=d();f.each(function(){if(!d(c+this.value).length){return}var k=d(this),j=d(c+this.value+"-hide");k.data("sectTarget",j);if(!(this.checked===j[0].checked)){j.prop("checked",this.checked).triggerHandler("click")}g=g.add(k)});if(g.length){g.change(function(){d(this).data("sectTarget").prop("checked",this.checked).triggerHandler("click")})}}d("ul.kc-rows").sortable({axis:"y",start:function(j,k){k.placeholder.height(k.item.outerHeight())},stop:function(j,k){k.item.parent().kcsbReorder(k.item.data("mode"))}});d(".row a.del").live("click",function(m){var l=d(this),j=l.closest(".row"),n=j.data("mode"),k=j.is(":last-child");if(!j.siblings(".row").length){return false}j.addClass("removing").fadeOut("slow",function(){d(this).remove();if(!k){j.parent().kcsbReorder(n)}});return false});d(".row a.add").live("click",function(m){var l=d(this),k=l.closest(".row"),n=k.data("mode"),j=k.clone(false).addClass("adding");if(e.length){j.find(".kc-rows").each(function(){var o=d(this).children(".row");if(o.length>1){o.not(":first").remove()}});j.find(":input").each(function(){var o=d(this);if(this.type=="text"||this.type=="textarea"){o.removeAttr("style").val("")}else{if(this.type=="checkbox"||this.type=="radio"){if(o.prop("checked")){this.checked=true}else{this.checked=false}}}if(o.is(".kcsb-ids")){o.kcsbUnique()}});d(".idep",j).kcsbIDep()}else{j.find(":input").each(function(){d(this).val("")})}k.after(j);j.kcsbGoto();setTimeout(function(){j.removeClass("adding")},1000);k.parent().kcsbReorder(n);return false});d(".row a.clear").live("click",function(j){d(this).closest(".row").find(":input").val("");return false});var b=d("input[type=date]");if(b.length&&Modernizr.inputtypes.date===false){b.datepicker({dateFormat:"yy-mm-dd"})}var h=d("input[type=color]");if(h.length&&Modernizr.inputtypes.color===false){Modernizr.load([{load:[win.kcSettings.paths.scripts+"/colorpicker/js/colorpicker.js",win.kcSettings.paths.scripts+"/colorpicker/css/colorpicker.css"],complete:function(){h.ColorPicker({onBeforeShow:function(){d(this).ColorPickerSetColor(this.value)},onSubmit:function(j,n,l,m){var k="#"+n;d(m).css("backgroundColor",k).val(k).ColorPickerHide()}}).each(function(){if(d(this).val()!==""){d(this).css("backgroundColor",d(this).val())}})}}])}d(".kcs-file a.rm").live("click",function(l){l.preventDefault();var k=d(this),j=k.closest(".row");j.addClass("removing").fadeOut("slow",function(){if(j.siblings().length){j.remove()}else{j.removeClass("removing").addClass("hidden").find(":input").val("").prop("checked",false);var m=d('input[type="hidden"]',j);m.data("olName",m.attr("name")).attr("name","")}})});d("a.kcsf-upload").live("click",function(n){n.preventDefault();var l=d(this),m=l.parent(),k=m.find(".row.hidden");win.kcSettings.upload.id=d("#"+m.attr("id")+" > ul");win.kcSettings.upload.files=[];if(k.length){var j=d('input[type="hidden"]',k);j.attr("name",j.data("olName"))}else{d("input.mid",m).each(function(){win.kcSettings.upload.files.push(this.value)})}tb_show("",l.attr("href"))});d("ul.kc-sortable").sortable({axis:"y",start:function(j,k){k.placeholder.height(k.item.outerHeight())}});if(!i.is(".hidden")){i.kcsbGoto()}d(".idep:input").kcsbIDep();d("input.kcsb-slug").live("blur",function(){var k=d(this),j=k.val();k.val(kcsbSlug(j))});d("input.kcsb-ids").kcsbUnique();d("input.required, input.clone-id").live("blur",function(){d(this).kcsbCheck()});d("#new-kcsb").live("click",function(){i.kcsbGoto();return false});d("a.kcsb-cancel").live("click",function(){d("#kcsb").fadeOut(function(){d("body").kcsbGoto()});return false});d("a.clone-open").live("click",function(){d(this).parent().children().hide().filter("div.kcsb-clone").fadeIn();return false});d("a.clone-do").click(function(){var j=d(this),k=d(this).siblings("input");if(k.kcsbCheck()===false){return false}j.attr("href",j.attr("href")+"&new="+k.val())});d("input.clone-id").bind("keypress",function(l){var j=l.keyCode||l.which;if(j===13){var k=d(this);l.preventDefault();k.blur().siblings("a.clone-do").data("new",k.val()).trigger("click")}});d(".kcsb-tools a.close").live("click",function(){var k=d(this),j=k.parent();k.siblings("input").val("");j.fadeOut(function(){d(this).siblings().show()});return false});e.submit(function(k){var j=true;d(this).find("input.required").not(":disabled").each(function(){if(d(this).kcsbCheck()===false){j=false;return false}});if(!j){return false}});d("a.kc-help-trigger").live("click",function(){d("#contextual-help-link").click();d("#screen-meta").kcsbGoto();return false})});