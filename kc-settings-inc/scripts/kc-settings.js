var win=window.dialogArguments||opener||parent||top;(function(a){win.kcFileMultiple=function(f){var b=win.kcSettings.upload.target,g=b.data("currentFiles"),d=b.children().last(),h=a(),c=null;for(var e in f){if(!f.hasOwnProperty(e)||a.inArray(f[e].id,g)>-1){continue}c=d.clone().removeClass("hidden");c.find("img").attr("src",f[e].img);c.find("input").val(f[e].id).prop("checked",false);c.find(".title").text(f[e].title);h=h.add(c)}b.append(h);if(d.is(".hidden")){h.show();d.remove()}b.show().prev(".info").show()};win.kcFileSingle=function(f){var b=win.kcSettings.upload.target,e=b.find("span").text(f.title),d=b.find("img").attr("src",f.img);b.removeAttr("data-type");b.find("input").val(f.id);b.children("a.up").hide();b.find("p").fadeIn().children("a.up").show().siblings("a.rm").show();if(f.type=="image"){b.attr("data-type",f.type);e.hide();var c=b.data("size");if(c!=="thumbnail"){a.ajax({type:"POST",url:ajaxurl,data:{action:"kc_get_image_url",id:f.id,size:c},success:function(g){if(g){d.attr("src",g)}}})}}else{e.show()}}})(jQuery);jQuery(document).ready(function(h){var g=h(this),e=h("body"),p=h("#kcsb"),i=h("form.kcsb"),c=h("#kc-settings-form");var k={sortable:{axis:"y",start:function(q,r){r.placeholder.height(r.item.outerHeight())},stop:function(q,r){r.item.parent().kcReorder(r.item.data("mode"),true).children().each(function(){h("> details > summary > .actions .count",this).text(h(this).index()+1)})}},colorpicker:{onBeforeShow:function(){h(this).ColorPickerSetColor(this.value)},onSubmit:function(q,u,s,t){var r="#"+u;h(t).css({backgroundColor:r,color:invertColor(r)}).val(r).ColorPickerHide()}},datepicker:{date:{dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,showButtonPanel:true},month:{changeMonth:true,changeYear:true,showButtonPanel:true,dateFormat:"yy-mm",onClose:function(u,s){var q=h(s.dpDiv),t=q.find(".ui-datepicker-month :selected").val(),r=q.find(".ui-datepicker-year :selected").val();h(this).datepicker("setDate",new Date(r,t,1))}}}};if(c.length){var f=c.find("div.metabox-holder");if(f.length){var b=f.attr("id"),n=c.find(":checkbox");if(n.length){var o=h();n.each(function(){var s=h("#"+b+"-"+this.value);if(!s.length){return}var r=h(this),q=h("#"+b+"-"+this.value+"-hide");r.data("sectHider",q).data("sectBox",s);if(!(this.checked===q[0].checked)){q.prop("checked",this.checked).triggerHandler("click")}o=o.add(r)});if(o.length){o.change(function(){var q=h(this);q.data("sectHider").prop("checked",this.checked).triggerHandler("click");if(this.checked){q.data("sectBox").kcGoto({offset:-40,speed:"slow"})}})}}}}h("ul.kc-rows").sortable(k.sortable);e.on("click",".row a.del",function(u){u.preventDefault();var r=h(this),q=r.closest(".row");if(!q.siblings(".row").length){r.siblings("a.clear").click();return}var s=q.parent(),v=q.data("mode"),t=q.is(":last-child");q.addClass("removing").fadeOut("slow",function(){q.remove();if(!t){s.kcReorder(v,true);if(i.length){s.children().each(function(){h("> details > summary > .actions .count",this).text(h(this).index()+1)})}}})});e.on("click",".row a.add",function(v){v.preventDefault();var y=h(this),x=y.closest(".row"),r=x.parent(),u=x.data("mode"),s=x.is(":last-child"),t=x.clone(false).addClass("adding"),w=false,q=400;if(u=="sections"){w=true;q=1200}else{if(u=="fields"){w=true;q=800}}if(i.length){t.find(".kc-rows").each(function(){h(this).children(".row").not(":first").remove()});t.find(":input").each(function(){var z=h(this);if(this.type=="text"||this.type=="textarea"){z.removeAttr("style").val("")}else{if(this.type=="checkbox"||this.type=="radio"){z.prop("checked",this.checked)}}if(z.is(".kcsb-ids")){z.kcsbUnique()}})}else{t.find(":input").each(function(){var z=h(this);if(z.data("nocleanup")!==true){z.val("")}})}h("ul.kc-rows").sortable(k.sortable);h(".hasdep",t).kcFormDep();h(".hasDatepicker",t).each(function(){h(this).removeClass("hasDatepicker").removeAttr("id").datepicker(k.datepicker[h(this).attr("type")])});h(".hasColorpicker",t).each(function(){h(this).removeAttr("style").ColorPicker(k.colorpicker)});x.after(t);if(w){t.kcGoto({offset:-100,speed:q})}setTimeout(function(){t.removeClass("adding")},q);r.kcReorder(u,true);if(i.length){if(s){h("> details > summary > .actions .count",t).text(t.index()+1)}else{r.children().each(function(){h("> details > summary > .actions .count",this).text(h(this).index()+1)})}}});e.on("click",".row a.clear",function(q){q.preventDefault();h(this).closest(".row").find(":input").val("")});var a=h("input[type=date], input[type=month]");if(a.length&&Modernizr.inputtypes.date===false){var j=h("body").is(".admin-color-classic")?"cupertino":"flick";Modernizr.load([{load:win.kcSettings.paths.styles+"/jquery-ui/"+j+"/style.css",complete:function(){a.each(function(){h(this).datepicker(k.datepicker[h(this).attr("type")])})}}])}var m=h("input[type=color]");if(m.length&&Modernizr.inputtypes.color===false){Modernizr.load([{load:[win.kcSettings.paths.scripts+"/colorpicker/js/colorpicker.js",win.kcSettings.paths.scripts+"/colorpicker/css/colorpicker.css",win.kcSettings.paths.scripts+"/rgbcolor.js"],complete:function(){m.ColorPicker(k.colorpicker).each(function(){var q=h(this).addClass("hasColorpicker");if(q.val()!==""){q.css({backgroundColor:this.value,color:invertColor(this.value)})}})}}])}e.on("click",".kcs-file a.rm",function(r){r.preventDefault();var q=h(this).closest(".row");q.addClass("removing").fadeOut("slow",function(){if(q.siblings().length){q.remove()}else{q.removeClass("removing").addClass("hidden").find(":input").val("").prop("checked",false);h("input.fileID",q).prop("disabled",true);q.parent().hide().prev(".info").hide()}})});e.on("click","a.kcsf-upload",function(u){u.preventDefault();var s=h(this),q=s.siblings(".kc-rows"),r=q.find(".row.hidden"),t=[];if(r.length){h("input.fileID",r).prop("disabled",false)}else{h("input.fileID",q).each(function(){t.push(this.value)})}win.kcSettings.upload.target=q.data("currentFiles",t);tb_show("",s.attr("href"))});e.on("click",".kcs-file-single a.rm",function(q){q.preventDefault();h(this).fadeOut().closest("div").find("p.current").fadeOut(function(){h(this).siblings("a.up").show().siblings("input").val("")})});e.on("click",".kcs-file-single a.up",function(r){r.preventDefault();var q=h(this);win.kcSettings.upload.target=q.closest("div");tb_show("",q.attr("href"))});h("a.kc-help-trigger").on("click",function(q){q.preventDefault();h("#contextual-help-link").click();h("#screen-meta").kcGoto()});h(".kcs-tabs").kcTabs();var l=h("#addtag");if(l.length){var d=h();h("div.kcs-field").each(function(){d=d.add(h(this).clone())});if(d.length){l.ajaxComplete(function(r,s,q){if(q.data.indexOf("action=add-tag")<0){return}h("div.kcs-field").each(function(t){h(this).replaceWith(d.eq(t).clone())});h(".kcs-tabs",l).kcTabs();l.trigger("kcsRefreshed")})}}if(p.length){if(!p.is(".hidden")){p.kcGoto()}h(".hasdep",p).kcFormDep();e.on("blur","input.kcsb-slug",function(){var q=h(this);q.val(kcsbSlug(q.val()))});h("input.kcsb-ids").kcsbUnique();e.on("blur","input.required, input.clone-id",function(){h(this).kcsbCheck()});h("#new-kcsb").on("click",function(q){q.preventDefault();p.kcGoto()});h("a.kcsb-cancel").on("click",function(q){q.preventDefault();h("#kcsb").slideUp("slow")});h("a.clone-open").on("click",function(q){q.preventDefault();h(this).parent().children().hide().filter("div.kcsb-clone").fadeIn(function(){h(this).find("input.clone-id").focus()})});h("a.clone-do").on("click",function(r){var q=h(this),s=h(this).siblings("input");if(s.kcsbCheck()===false){return false}q.attr("href",q.attr("href")+"&new="+s.val())});h("input.clone-id").on("keypress",function(r){var q=r.keyCode||r.which;if(q===13){r.preventDefault();h(this).blur().siblings("a.clone-do").click()}});h(".kcsb-tools a.close").on("click",function(r){r.preventDefault();var q=h(this);q.siblings("input").val("");q.parent().fadeOut(function(){h(this).siblings().show()})});i.submit(function(r){var q=true;h(this).find("input.required").not(":disabled").each(function(){if(h(this).kcsbCheck()===false){q=false;return false}});if(!q){return false}})}});