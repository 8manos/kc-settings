var win=window.dialogArguments||opener||parent||top;(function(a){win.kcFileMultiple=function(f){var b=win.kcSettings.upload.target,g=b.data("currentFiles"),d=b.children().last(),h=a(),c=null;for(var e in f){if(!f.hasOwnProperty(e)||a.inArray(f[e].id,g)>-1){continue}c=d.clone().removeClass("hidden");c.find("img").attr("src",f[e].img);c.find("input").val(f[e].id).prop("checked",false);c.find(".title").text(f[e].title);h=h.add(c)}b.append(h);if(d.is(".hidden")){h.show();d.remove()}b.show().prev(".info").show()};win.kcFileSingle=function(f){var b=win.kcSettings.upload.target,e=b.find("span").text(f.title),d=b.find("img").attr("src",f.img);b.removeAttr("data-type");b.find("input").val(f.id);b.children("a.up").hide();b.find("p").fadeIn().children("a.up").show().siblings("a.rm").show();if(f.type=="image"){b.attr("data-type",f.type);e.hide();var c=b.data("size");if(c!=="thumbnail"){a.ajax({type:"POST",url:ajaxurl,data:{action:"kc_get_image_url",id:f.id,size:c},success:function(g){if(g){d.attr("src",g)}}})}}else{e.show()}}})(jQuery);jQuery(document).ready(function(e){var d=e(this),c=e("body");var g={sortable:{axis:"y",start:function(j,k){k.placeholder.height(k.item.outerHeight())},stop:function(j,k){k.item.parent().kcReorder(k.item.data("mode"),true).children().each(function(){e("> details > summary > .actions .count",this).text(e(this).index()+1)})}},colorpicker:{onBeforeShow:function(){e(this).ColorPickerSetColor(this.value)},onSubmit:function(j,n,l,m){var k="#"+n;e(m).css({backgroundColor:k,color:invertColor(k)}).val(k).ColorPickerHide()}},datepicker:{date:{dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,showButtonPanel:true},month:{changeMonth:true,changeYear:true,showButtonPanel:true,dateFormat:"yy-mm",onClose:function(n,l){var j=e(l.dpDiv),m=j.find(".ui-datepicker-month :selected").val(),k=j.find(".ui-datepicker-year :selected").val();e(this).datepicker("setDate",new Date(k,m,1))}}}};e("#kc-settings-form").kcMetaboxDeps();e.kcRowCloner();e.kcRowCloner.addCallback("add",function(j){e("ul.kc-rows").sortable("refresh");e(".hasDatepicker",j.nuItem).each(function(){e(this).removeData("datepicker").removeClass("hasDatepicker").datepicker(g.datepicker[e(this).attr("type")])});e(".hasColorpicker",j.nuItem).each(function(){e(this).removeData("colorpickerId").removeAttr("style").ColorPicker(g.colorpicker)})});e("ul.kc-rows").sortable(g.sortable);e(".kcs-tabs").kcTabs();var a=e("input[type=date], input[type=month]");if(a.length&&Modernizr.inputtypes.date===false){var f=e("body").is(".admin-color-classic")?"cupertino":"flick";Modernizr.load([{load:win.kcSettings.paths.styles+"/jquery-ui/"+f+"/style.css",complete:function(){a.each(function(){e(this).datepicker(g.datepicker[e(this).attr("type")])})}}])}var i=e("input[type=color]");if(i.length&&Modernizr.inputtypes.color===false){Modernizr.load([{load:[win.kcSettings.paths.scripts+"/colorpicker/js/colorpicker.js",win.kcSettings.paths.scripts+"/colorpicker/css/colorpicker.css",win.kcSettings.paths.scripts+"/rgbcolor.js"],complete:function(){i.ColorPicker(g.colorpicker).each(function(){var j=e(this).addClass("hasColorpicker");if(j.val()!==""){j.css({backgroundColor:this.value,color:invertColor(this.value)})}})}}])}c.on("click",".kcs-file a.rm",function(k){k.preventDefault();var j=e(this).closest(".row");j.addClass("removing").fadeOut("slow",function(){if(j.siblings().length){j.remove()}else{j.removeClass("removing").addClass("hidden").find(":input").val("").prop("checked",false);e("input.fileID",j).prop("disabled",true);j.parent().hide().prev(".info").hide()}})});c.on("click","a.kcsf-upload",function(n){n.preventDefault();var l=e(this),j=l.siblings(".kc-rows"),k=j.find(".row.hidden"),m=[];if(k.length){e("input.fileID",k).prop("disabled",false)}else{e("input.fileID",j).each(function(){m.push(this.value)})}win.kcSettings.upload.target=j.data("currentFiles",m);tb_show("",l.attr("href"))});c.on("click",".kcs-file-single a.rm",function(j){j.preventDefault();e(this).fadeOut().closest("div").find("p.current").fadeOut(function(){e(this).siblings("a.up").show().siblings("input").val("")})});c.on("click",".kcs-file-single a.up",function(k){k.preventDefault();var j=e(this);win.kcSettings.upload.target=j.closest("div");tb_show("",j.attr("href"))});e("a.kc-help-trigger").on("click",function(j){j.preventDefault();e("#contextual-help-link").click();e("#screen-meta").kcGoto()});var h=e("#addtag");if(h.length){var b=e();e("div.kcs-field").each(function(){b=b.add(e(this).clone())});if(b.length){h.ajaxComplete(function(k,l,j){if(j.data.indexOf("action=add-tag")<0){return}e("div.kcs-field").each(function(m){e(this).replaceWith(b.eq(m).clone())});e(".kcs-tabs",h).kcTabs();h.trigger("kcsRefreshed")})}}});