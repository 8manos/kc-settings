var win=window.dialogArguments||opener||parent||top;(function(a){win.kcFileMultiple=function(f){var b=win.kcSettings.upload.target,g=b.data("currentFiles"),d=b.children().last(),h=a(),c=null;for(var e in f){if(!f.hasOwnProperty(e)||a.inArray(f[e].id,g)>-1){continue}c=d.clone().removeClass("hidden");c.find("img").attr("src",f[e].img);c.find("input").val(f[e].id).prop("checked",false);c.find(".title").text(f[e].title);h=h.add(c)}b.append(h);if(d.is(".hidden")){h.show();d.remove()}b.show().prev(".info").show()};win.kcFileSingle=function(f){var b=win.kcSettings.upload.target,e=b.find("span").text(f.title),d=b.find("img").attr("src",f.img);b.removeAttr("data-type");b.find("input").val(f.id);b.children("a.up").hide();b.find("p").fadeIn().children("a.up").show().siblings("a.rm").show();if(f.type=="image"){b.attr("data-type",f.type);e.hide();var c=b.data("size");if(c!=="thumbnail"){a.ajax({type:"POST",url:ajaxurl,data:{action:"kc_get_image_url",id:f.id,size:c},success:function(g){if(g){d.attr("src",g)}}})}}else{e.show()}}})(jQuery);jQuery(document).ready(function(f){var m=f("#kcsb"),g=f("form.kcsb"),c=f("#kc-settings-form");if(c.length){var e=c.find("div.metabox-holder");if(e.length){var b=e.attr("id"),k=c.find(":checkbox");if(k.length){var l=f();k.each(function(){var p=f("#"+b+"-"+this.value);if(!p.length){return}var o=f(this),n=f("#"+b+"-"+this.value+"-hide");o.data("sectHider",n).data("sectBox",p);if(!(this.checked===n[0].checked)){n.prop("checked",this.checked).triggerHandler("click")}l=l.add(o)});if(l.length){l.change(function(){var n=f(this);n.data("sectHider").prop("checked",this.checked).triggerHandler("click");if(this.checked){n.data("sectBox").kcGoto({offset:-40,speed:"slow"})}})}}}}f("ul.kc-rows").sortable({axis:"y",start:function(n,o){o.placeholder.height(o.item.outerHeight())},stop:function(n,o){o.item.parent().kcReorder(o.item.data("mode"),true).children().each(function(){f("> .actions .count",this).text(f(this).index()+1)})}});f(".row a.del").live("click",function(r){var q=f(this),n=q.closest(".row"),o=n.parent(),s=n.data("mode"),p=n.is(":last-child");if(!n.siblings(".row").length){return false}n.addClass("removing").fadeOut("slow",function(){n.remove();if(!p){o.kcReorder(s,true);if(g.length){o.children().each(function(){f("> .actions .count",this).text(f(this).index()+1)})}}});return false});f(".row a.add").live("click",function(s){var t=f(this),v=t.closest(".row"),o=v.parent(),r=v.data("mode"),p=v.is(":last-child"),q=v.clone(false).addClass("adding"),u=false,n=400;if(r=="sections"){u=true;n=1200}else{if(r=="fields"){u=true;n=800}}if(g.length){q.find(".kc-rows").each(function(){var w=f(this).children(".row");if(w.length>1){w.not(":first").remove()}});q.find(":input").each(function(){var w=f(this);if(this.type=="text"||this.type=="textarea"){w.removeAttr("style").val("")}else{if(this.type=="checkbox"||this.type=="radio"){w.prop("checked",this.checked)}}if(w.is(".kcsb-ids")){w.kcsbUnique()}})}else{q.find(":input").each(function(){if(f(this).data("nocleanup")!==true){f(this).val("")}})}f(".hasdep",q).kcFormDep();v.after(q);if(u){q.kcGoto({offset:-100,speed:n})}setTimeout(function(){q.removeClass("adding")},n);o.kcReorder(r,true);if(g.length){if(p){f("> .actions .count",q).text(q.index()+1)}else{o.children().each(function(){f("> .actions .count",this).text(f(this).index()+1)})}}return false});f(".row a.clear").live("click",function(n){f(this).closest(".row").find(":input").val("");return false});var a=f("input[type=date]");if(a.length&&Modernizr.inputtypes.date===false){var h=f("body").is(".admin-color-classic")?"cupertino":"flick";Modernizr.load([{load:win.kcSettings.paths.styles+"/jquery-ui/"+h+"/style.css",complete:function(){a.datepicker({dateFormat:"yy-mm-dd"})}}])}var j=f("input[type=color]");if(j.length&&Modernizr.inputtypes.color===false){Modernizr.load([{load:[win.kcSettings.paths.scripts+"/colorpicker/js/colorpicker.js",win.kcSettings.paths.scripts+"/colorpicker/css/colorpicker.css",win.kcSettings.paths.scripts+"/rgbcolor.js"],complete:function(){j.ColorPicker({onBeforeShow:function(){f(this).ColorPickerSetColor(this.value)},onSubmit:function(n,r,p,q){var o="#"+r;f(q).css({backgroundColor:o,color:invertColor(o)}).val(o).ColorPickerHide()}}).each(function(){var n=f(this);if(n.val()!==""){n.css({backgroundColor:this.value,color:invertColor(this.value)})}})}}])}f(".kcs-file a.rm").live("click",function(p){p.preventDefault();var o=f(this),n=o.closest(".row");n.addClass("removing").fadeOut("slow",function(){if(n.siblings().length){n.remove()}else{n.removeClass("removing").addClass("hidden").find(":input").val("").prop("checked",false);f("input.fileID",n).prop("disabled",true);n.parent().hide().prev(".info").hide()}})});f("a.kcsf-upload").live("click",function(r){r.preventDefault();var p=f(this),n=p.siblings(".kc-rows"),o=n.find(".row.hidden"),q=[];if(o.length){f("input.fileID",o).prop("disabled",false)}else{f("input.fileID",n).each(function(){q.push(this.value)})}win.kcSettings.upload.target=n.data("currentFiles",q);tb_show("",p.attr("href"))});f(".kcs-file-single a.rm").on("click",function(n){n.preventDefault();f(this).fadeOut().closest("div").find("p.current").fadeOut(function(){f(this).siblings("a.up").show().siblings("input").val("")})});f(".kcs-file-single a.up").live("click",function(o){o.preventDefault();var n=f(this);win.kcSettings.upload.target=n.closest("div");tb_show("",n.attr("href"))});f("ul.kc-sortable").sortable({axis:"y",start:function(n,o){o.placeholder.height(o.item.outerHeight())}});f("a.kc-help-trigger").live("click",function(){if(win.kcHelpBox!==undefined){win.kcPopHelp()}else{f("#contextual-help-link").click();f("#screen-meta").kcGoto()}return false});f(".kcs-tabs").kcTabs();var i=f("#addtag");if(i.length){var d=f();f("div.kcs-field").each(function(){d=d.add(f(this).clone())});if(d.length){i.ajaxComplete(function(o,p,n){if(n.data.indexOf("action=add-tag")<0){return}f("div.kcs-field").each(function(q){f(this).replaceWith(d.eq(q).clone())});f(".kcs-tabs",i).kcTabs();i.trigger("kcsRefreshed")})}}if(m.length){if(!m.is(".hidden")){m.kcGoto()}f(".hasdep",m).kcFormDep();f("input.kcsb-slug").live("blur",function(){var o=f(this),n=o.val();o.val(kcsbSlug(n))});f("input.kcsb-ids").kcsbUnique();f("input.required, input.clone-id").live("blur",function(){f(this).kcsbCheck()});f("#new-kcsb").live("click",function(){m.kcGoto();return false});f("a.kcsb-cancel").live("click",function(){f("#kcsb").fadeOut(function(){f("body").kcGoto()});return false});f("a.clone-open").live("click",function(){f(this).parent().children().hide().filter("div.kcsb-clone").fadeIn();return false});f("a.clone-do").click(function(){var n=f(this),o=f(this).siblings("input");if(o.kcsbCheck()===false){return false}n.attr("href",n.attr("href")+"&new="+o.val())});f("input.clone-id").bind("keypress",function(p){var n=p.keyCode||p.which;if(n===13){var o=f(this);p.preventDefault();o.blur().siblings("a.clone-do").data("new",o.val()).trigger("click")}});f(".kcsb-tools a.close").live("click",function(){var o=f(this),n=o.parent();o.siblings("input").val("");n.fadeOut(function(){f(this).siblings().show()});return false});g.submit(function(o){var n=true;f(this).find("input.required").not(":disabled").each(function(){if(f(this).kcsbCheck()===false){n=false;return false}});if(!n){return false}})}});