var win=window.dialogArguments||opener||parent||top;(function(a){win.kcFileMultiple=function(f){var b=win.kcSettings.upload.target,g=b.data("currentFiles"),d=b.children().last(),h=a(),c=null;for(var e in f){if(!f.hasOwnProperty(e)||a.inArray(f[e].id,g)>-1){continue}c=d.clone().removeClass("hidden");c.find("img").attr("src",f[e].img);c.find("input").val(f[e].id).prop("checked",false);c.find(".title").text(f[e].title);h=h.add(c)}b.append(h);if(d.is(".hidden")){h.show();d.remove()}b.show().prev(".info").show()};win.kcFileSingle=function(d){var b=win.kcSettings.upload.target.removeAttr("data-type"),c=b.find("span").text(d.title);b.find("input").val(d.id).trigger("change",{update:true}).siblings("a").hide().siblings("p").fadeIn().find("img").attr("src",d.img);if(d.type=="image"){b.attr("data-type",d.type);c.hide()}else{c.show()}}})(jQuery);jQuery(document).ready(function(e){var k=e("#kcsb"),f=e("form.kcsb"),c=e("#kc-settings-form");if(c.length){var d=c.find("div.metabox-holder");if(d.length){var b=d.attr("id"),i=c.find(":checkbox");if(i.length){var j=e();i.each(function(){var n=e("#"+b+"-"+this.value);if(!n.length){return}var m=e(this),l=e("#"+b+"-"+this.value+"-hide");m.data("sectHider",l).data("sectBox",n);if(!(this.checked===l[0].checked)){l.prop("checked",this.checked).triggerHandler("click")}j=j.add(m)});if(j.length){j.change(function(){var l=e(this);l.data("sectHider").prop("checked",this.checked).triggerHandler("click");if(this.checked){l.data("sectBox").kcGoto({offset:-40,speed:"slow"})}})}}}}e("ul.kc-rows").sortable({axis:"y",start:function(l,m){m.placeholder.height(m.item.outerHeight())},stop:function(l,m){m.item.parent().kcReorder(m.item.data("mode"),true).children().each(function(){e("> .actions .count",this).text(e(this).index()+1)})}});e(".row a.del").live("click",function(p){var o=e(this),l=o.closest(".row"),m=l.parent(),q=l.data("mode"),n=l.is(":last-child");if(!l.siblings(".row").length){return false}l.addClass("removing").fadeOut("slow",function(){l.remove();if(!n){m.kcReorder(q,true);if(f.length){m.children().each(function(){e("> .actions .count",this).text(e(this).index()+1)})}}});return false});e(".row a.add").live("click",function(q){var r=e(this),t=r.closest(".row"),m=t.parent(),p=t.data("mode"),n=t.is(":last-child"),o=t.clone(false).addClass("adding"),s=false,l=400;if(p=="sections"){s=true;l=1200}else{if(p=="fields"){s=true;l=800}}if(f.length){o.find(".kc-rows").each(function(){var u=e(this).children(".row");if(u.length>1){u.not(":first").remove()}});o.find(":input").each(function(){var u=e(this);if(this.type=="text"||this.type=="textarea"){u.removeAttr("style").val("")}else{if(this.type=="checkbox"||this.type=="radio"){u.prop("checked",this.checked)}}if(u.is(".kcsb-ids")){u.kcsbUnique()}})}else{o.find(":input").each(function(){if(e(this).data("nocleanup")!==true){e(this).val("")}})}e(".hasdep",o).kcFormDep();t.after(o);if(s){o.kcGoto({offset:-100,speed:l})}setTimeout(function(){o.removeClass("adding")},l);m.kcReorder(p,true);if(f.length){if(n){e("> .actions .count",o).text(o.index()+1)}else{m.children().each(function(){e("> .actions .count",this).text(e(this).index()+1)})}}return false});e(".row a.clear").live("click",function(l){e(this).closest(".row").find(":input").val("");return false});var a=e("input[type=date]");if(a.length&&Modernizr.inputtypes.date===false){var g=e("body").is(".admin-color-classic")?"cupertino":"flick";Modernizr.load([{load:win.kcSettings.paths.styles+"/jquery-ui/"+g+"/style.css",complete:function(){a.datepicker({dateFormat:"yy-mm-dd"})}}])}var h=e("input[type=color]");if(h.length&&Modernizr.inputtypes.color===false){Modernizr.load([{load:[win.kcSettings.paths.scripts+"/colorpicker/js/colorpicker.js",win.kcSettings.paths.scripts+"/colorpicker/css/colorpicker.css",win.kcSettings.paths.scripts+"/rgbcolor.js"],complete:function(){h.ColorPicker({onBeforeShow:function(){e(this).ColorPickerSetColor(this.value)},onSubmit:function(l,p,n,o){var m="#"+p;e(o).css({backgroundColor:m,color:invertColor(m)}).val(m).ColorPickerHide()}}).each(function(){var l=e(this);if(l.val()!==""){l.css({backgroundColor:this.value,color:invertColor(this.value)})}})}}])}e(".kcs-file a.rm").live("click",function(n){n.preventDefault();var m=e(this),l=m.closest(".row");l.addClass("removing").fadeOut("slow",function(){if(l.siblings().length){l.remove()}else{l.removeClass("removing").addClass("hidden").find(":input").val("").prop("checked",false);e("input.fileID",l).prop("disabled",true);l.parent().hide().prev(".info").hide()}})});e("a.kcsf-upload").live("click",function(p){p.preventDefault();var n=e(this),l=n.siblings(".kc-rows"),m=l.find(".row.hidden"),o=[];if(m.length){e("input.fileID",m).prop("disabled",false)}else{e("input.fileID",l).each(function(){o.push(this.value)})}win.kcSettings.upload.target=l.data("currentFiles",o);tb_show("",n.attr("href"))});e(".kcs-file-single a.rm").live("click",function(l){l.preventDefault();e(this).fadeOut().closest("div").find("p.current").fadeOut(function(){e(this).siblings("a.up").show().siblings("input").val("")})});e(".kcs-file-single a.up").live("click",function(m){m.preventDefault();var l=e(this);win.kcSettings.upload.target=l.closest("div");tb_show("",l.attr("href"))});e(".kcs-file-single input").live("change",function(q,p){if(p===undefined||!p.hasOwnProperty("update")||!p.update){return}var o=e(this),m=o.val();if(!m){return}var l=o.closest("div"),n=l.size;e.ajax({type:"POST",url:ajaxurl,data:{action:"kc_get_image_url",id:m,size:l.data("size")},success:function(r){if(r!==0){l.find("img").attr("src",r)}}})});e("ul.kc-sortable").sortable({axis:"y",start:function(l,m){m.placeholder.height(m.item.outerHeight())}});e("a.kc-help-trigger").live("click",function(){if(win.kcHelpBox!==undefined){win.kcPopHelp()}else{e("#contextual-help-link").click();e("#screen-meta").kcGoto()}return false});e("#addtag").ajaxComplete(function(n,m){var l=e(this);e(".kcs-input",l).val("");e(".kcs-multiinput > li.row",l).not(":first-child").remove()});if(k.length){if(!k.is(".hidden")){k.kcGoto()}e(".hasdep",k).kcFormDep();e("input.kcsb-slug").live("blur",function(){var m=e(this),l=m.val();m.val(kcsbSlug(l))});e("input.kcsb-ids").kcsbUnique();e("input.required, input.clone-id").live("blur",function(){e(this).kcsbCheck()});e("#new-kcsb").live("click",function(){k.kcGoto();return false});e("a.kcsb-cancel").live("click",function(){e("#kcsb").fadeOut(function(){e("body").kcGoto()});return false});e("a.clone-open").live("click",function(){e(this).parent().children().hide().filter("div.kcsb-clone").fadeIn();return false});e("a.clone-do").click(function(){var l=e(this),m=e(this).siblings("input");if(m.kcsbCheck()===false){return false}l.attr("href",l.attr("href")+"&new="+m.val())});e("input.clone-id").bind("keypress",function(n){var l=n.keyCode||n.which;if(l===13){var m=e(this);n.preventDefault();m.blur().siblings("a.clone-do").data("new",m.val()).trigger("click")}});e(".kcsb-tools a.close").live("click",function(){var m=e(this),l=m.parent();m.siblings("input").val("");l.fadeOut(function(){e(this).siblings().show()});return false});f.submit(function(m){var l=true;e(this).find("input.required").not(":disabled").each(function(){if(e(this).kcsbCheck()===false){l=false;return false}});if(!l){return false}})}});