var win=window.dialogArguments||opener||parent||top;(function(a){a.fn.kcsfsPrepare=function(c,b){return this.each(function(){var d=a(this),f=d.children();if(!f.length){return}var e=win.kcSettings.upload.target.find("input").val();f.each(function(){var h=a(this);if(h.find("a.kc-select").length){return}var g=c?b:h.attr("id").split("-")[2];if(g===e){return}var j=h.find("img.pinkynail").attr("src"),k=h.find(".title").text(),i=h.find("#type-of-"+g).val();a('<a href="#" class="kc-select" data-id="'+g+'" data-img="'+j+'" data-title="'+k+'" data-type="'+i+'">'+win.kcSettings.upload.text.selFile+"</a>").prependTo(h.children(".new"))})})};a(document).ready(function(b){b("#media-items").on("click","a.kc-select",function(c){c.preventDefault();win.kcFileSingle(b(this).data());win.tb_remove()});b("#library-form, #gallery-form").find("#media-items").kcsfsPrepare(false);b("#media-upload").ajaxComplete(function(d,f,c){if(f.status!==200||c.url!=="async-upload.php"){return}b("#media-items",this).kcsfsPrepare(true,f.responseText.match(/type-of-(\d+)/)[1])})})})(jQuery);